 {% extends "layouts.html" %}

{% block title %}
    Tinder For Gamers
{% endblock %}

{% block body %}
    <h1>Welcome to the Local Game Finder!</h1>
    
    {% if login %}
        <div class="container" style="max-height: 80%; min-height: 80%;">
            <div class="row">
                <div class="col-sm"></div>
                <div class="col-sm"><h3>Hello, {{ user }}</h3></div>
                <div class="col-sm"><form action="{{ url_for('logout') }}" method="POST"><input type="submit" value="Logout"></form></div>
            </div>
            <div class="row">    
                <div class="col">
                    <h4>Set Your User Status</h4>
                        <form action="{{ url_for('status') }}" method="POST">
                            <div class="form-group">
                                {% if host and not player %} <input type="radio" id="host" name="status" value="host" checked> Host
                                {% else %} <input type="radio" id="host" name="status" value="host"> Host {% endif %}
                                {% if player and not host %} <input type="radio" id="player" name="status" value="player" checked>Player
                                {% else %} <input type="radio" id="player" name="status" value="player"> Player {% endif %}
                                {% if host and player %}<input type="radio" id="both" name="status" value="both" checked> Both 
                                {% else %} <input type="radio" id="both" name="status" value="both"> Both {% endif %}
                                <br>
                                {% if gametype %} <input type="radio" id="board" name="gametype" value=0 checked>Board Games
                                {% else %} <input type="radio" id="board" name="gametype" value=0> Board Games {% endif %}
                                {% if not gametype %} <input type="radio" id="video" name="gametype" value=1 checked>Video Games
                                {% else %} <input type="radio" id="video" name="gametype" value=1>Video Games {% endif %}
                                <br><input type="submit"  value="Submit">
                            </div>
                        </form>
                    {% if player %}
                        <h4>Search for a Game to Play:</h4>
                        <form action="{{ url_for('search') }}" method="POST">
                            Select a Location on the Map <br> 
                            <input type="text" id="lat" name="lat" value=0 hidden>
                            <input type="text" id="lon" name="lon" value=0 hidden>
                            <input type="text" name="genre"   placeholder="Game Genre"> <br>
                            <input type="text" name="title"     placeholder="Search Title"> <br>
                            <select name="radius" id="searchradius" aria-placeholder="Search Radius">
                                <option value="" selected disabled hidden>Search Radius</option>
                                <option value=1>1km</option>
                                <option value=2>2km</option>
                                <option value=5>5km</option>
                                <option value=10>10km</option>
                            </select> <br>
                            <button>Search</button>
                        </form>
                    {% endif %}
                    {% if host %}
                        <!--Will have Event Creation Data-->
                        <h4>Event Maker:</h4>
                        <form action="{{ url_for('search') }}" method="POST">
                            Select a Location on the Map <br>
                            <input type="text" name="event"   placeholder="Event name"> <br>
                            <input type="text" name="hostgame"     placeholder="Game Being Hosted"> <br>
                            <input type="radio" name="locationprivacy" value="private"> Private
                            <input type="radio" name="locationprivacy" value="public"> Public
                            <button>Host</button>
                        </form>
                    {% endif %} <br>
                </div>
                <div class="col-8">
                    <div id="mapid"></div>           
                </div>
            </div>
        </div>


        <script type="text/javascript">
            //Java Script - Mapping Application
            //MapboxGL access token
            mapboxgl.accessToken = 'pk.eyJ1Ijoic2ViYXNpYW5tYXBwZXIiLCJhIjoiY2s3bmw2d2V6MDE0NTNtcDZkano3NDNuaiJ9.4PhNi66A_sAecq8EBHsqyQ';

            // Create Map
            var mymap = L.map('mapid').setView([51.0447, -114.0719], 10);

            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/dark-v10',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: mapboxgl.accessToken,
                center: [51.0447, -114.0719],//calgary coordinates
                zoom: 10
            }).addTo(mymap);


            //Insert marker when user clicks on map
            var popup = L.popup();
            function onMapClick(e) {
                popup
                    .setLatLng(e.latlng)
                    .setContent("Your Location: (" + e.latlng.lat.toPrecision(6) + ", " + e.latlng.lng.toPrecision(7) + ")")
                    .openOn(mymap);
                document.getElementById("lat").value = e.latlng.lat;
                document.getElementById("lon").value = e.latlng.lng;


            }
            mymap.on('click', onMapClick);

            //if {{search}}:
                var rad = {{rad}} * 1000;
                var lat = {{ulat}};
                var lon = {{ulon}};
                var searchrad = L.circle([lat, lon], {color: "red", radius: rad}).addTo(mymap);

        </script>

    {% else %}
        <h3>Please Login or Register</h3>
        
        <h4>Login:</h4>
        <form action="{{ url_for('login') }}" method="POST">
            <input type="text"  name="username"  placeholder="Username" id="user">      <br>
            <input type="text"  name="password"  placeholder="Password" id="password">  <br>
            <button>Login</button>
        </form>
        
        <h4>Register:</h4>
        <form action="{{ url_for('register') }}" method="POST">
            <input type="text"  name="email"    placeholder="Email"     id="email" >    <br>
            <input type="text"  name="username" placeholder="Username"  id="user" >     <br>
            <input type="text"  name="password" placeholder="Password"  id="password">  <br>
            <input type="text"  name="confirm"  placeholder="Confirm Password">         <br>
            <button>Register</button>
        </form>
    {% endif %}
{% endblock %}